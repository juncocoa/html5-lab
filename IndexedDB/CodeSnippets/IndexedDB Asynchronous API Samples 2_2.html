<html>
<head>
  <title>Delete Object Store (Async)</title>
  <meta http-equiv="X-UA-Compatible" content="IE=8" />
   <script src='..\bootidb.js'></script>
  <script>
  
      ////////////////////////////////////////////
      //global variables
      ////////////////////////////////////////////
      var indexedDBName = "AsyncIndexedDB2";
      var indexedDBDescription = "";
	  var version = "2.0";
	  
      ////////////////////////////////////////////
      //sample data
      ////////////////////////////////////////////
      var objStoreNames =
      [
         "KIDSTORE", "CANDYSTORE", "CANDYSALESTORE"
      ];

      var OBJECTSTORES =
      [
	    { name: "KIDSTORE", keyPath: "id", autoIncrement: true },
	    { name: "CANDYSTORE", keyPath: "id", autoIncrement: false },
	    { name: "CANDYSALESTORE", keyPath: "id", autoIncrement: true }
      ];

      ///////////////////////////////////
      //utility functions
      ////////////////////////////////////

      function PrintDBInformation(idb) {
          if (idb) {
              var sName = idb.name;
              var dVersion = idb.version;
              var dTableNames = idb.objectStoreNames;
              var strNames = "IndexedDB name: " + sName
                            + "; version: " + dVersion + "; object stores: ";
              if (dTableNames.length > 0)
            	strNames += "Object Stores: ";

              for (var i = 0; i < dTableNames.length; i++) {
                  strNames = strNames + dTableNames[i] + ", ";
              }
              output_trace(strNames);
          }
      }
    
      function Async_deleteObjectStores_versionChange_commit() {
          Async_deleteObjectStores(true);
      }

      function Async_deleteObjectStores_versionChange_abort() {
          Async_deleteObjectStores(false);
      }

      function Async_deleteObjectStores(txnCommit) {
          try {
              var dbreq = window.indexedDB.open(indexedDBName);
              dbreq.onsuccess = function (event) {
                  var db = event.result;
                  PrintDBInformation(db);
                  var setVerReq = db.setVersion(version);
                  setVerReq.onsuccess = function (event) {
                      var txn = event.result;
                      if (txn) {
	                      txn.oncomplete = function () {
                              output_trace("deleteObjectStore completed.");
                              PrintDBInformation(db);
                              db.close();
                          }
                          txn.onabort = function () {
                              output_trace("deleteObjectStore aborted." + ev.message);
                              PrintDBInformation(db);
                              db.close();
                          }
                          txn.ontimeout = function () {
                              output_trace("deleteObjectStore." + ev.message);
                              PrintDBInformation(db);
                              db.close();
                          }
                          
                          try {
                              deleteObjectStore(db, txn, OBJECTSTORES,
                              0, txnCommit);
                          }
                          catch (e) {
                              output_trace("deleteObjectStore exception: "
                              + e.message);
                              txn.abort();
                          }                          
                      }
                  }
                  setVerReq.onerror = function (event) {
                      output_trace("db.setVersion error. " + event.message);
                      db.close();
                  }
                  setVerReq.onblocked = function (event) {
                      output_trace("db.setVersion blocked. " + event.message);
                      db.close();
                  }
              }
              dbreq.onerror = function (event) {
                  output_trace("indexedDB.open Error: " + event.message);
              }
          }
          catch (e) {
              output_trace("Error: " + e.message);
          }
      }
           
       function deleteObjectStore(tDb, txn, objs, i, commitT) {
          var params = objs[i];
          var storeReq = tDb.deleteObjectStore(params.name);
          storeReq.onsuccess = function (ev) {
              output_trace("ObjectStore " + params.name + " deleted.");
              i++;
              if (i < objs.length)
                  deleteObjectStore(tDb, txn, objs, i, commitT);
              else if (i == objs.length) {
                  if (commitT == true)
                  {
                     tDb.close(); //  txn.commit();
                     output_trace("deleteObjectStore completed.");
                  }
                  else
                      txn.abort();
              }
          }
          storeReq.onerror = function (ev) {
              output_trace("deleteObjectStore " + params.name + " Error: " + ev.message);
              i++;
              if (i < objs.length)
                  deleteObjectStore(tDb, txn, objs, i, commitT);
              else if (i == objs.length) {
                  if (commitT == true)
                      tDb.close(); // txn.commit();
                  else
                      txn.abort();
                  
              }
          }
      }

   	  function output_trace(sMsg){
		var oTrace = document.getElementById("traceoutput");
		if (oTrace.value == "")
			oTrace.value = sMsg;
		else
			oTrace.value = oTrace.value + "\n"+ sMsg;
	  }

</script>
</head>
<body>
<h2>IndexedDB Asynchronous API Samples</h2>
<h3>Delete object store</h3>
<div style="float:right;">
<div style="height: 320px;">

	<label>Trace</label><br>
	<textarea id="traceoutput" style="width:100%;height:288px;" cols="20" name="S1" rows="1"></textarea>
</div>
<div id="codeSnippetWrapper" style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; max-height: 200px; overflow: auto; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; direction: ltr; text-align: left;">
<pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum1" style="color: #606060;">   1:</span> <span style="color: #0000ff;">function</span> output_trace(sMsg){</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum2" style="color: #606060;">   2:</span>        <span style="color: #0000ff;">var</span> oTrace = document.getElementById(<span style="color: #006080;">"traceoutput"</span>);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum3" style="color: #606060;">   3:</span>        <span style="color: #0000ff;">if</span> (oTrace.value == <span style="color: #006080;">""</span>)</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum4" style="color: #606060;">   4:</span>            oTrace.value = sMsg;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum5" style="color: #606060;">   5:</span>        <span style="color: #0000ff;">else</span></pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum6" style="color: #606060;">   6:</span>            oTrace.value = oTrace.value + <span style="color: #006080;">"\n"</span>+ sMsg;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum7" style="color: #606060;">   7:</span>      }</pre><!--CRLF--></div></div>
</div>
<button onclick='Async_deleteObjectStores_versionChange_commit()'>Delete ObjectStores and commit</button>
<br />
<button onclick='Async_deleteObjectStores_versionChange_abort()'>Delete ObjectStores and abort</button>
<div id="codeSnippetWrapper" style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; overflow: visible; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; direction: ltr; text-align: left;">
<pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum1" style="color: #606060;">   1:</span> <span style="color: #0000ff;">function</span> Async_deleteObjectStores_versionChange_commit() {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum2" style="color: #606060;">   2:</span>           Async_deleteObjectStores(<span style="color: #0000ff;">true</span>);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum3" style="color: #606060;">   3:</span>       }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum4" style="color: #606060;">   4:</span> &nbsp;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum5" style="color: #606060;">   5:</span>       <span style="color: #0000ff;">function</span> Async_deleteObjectStores_versionChange_abort() {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum6" style="color: #606060;">   6:</span>           Async_deleteObjectStores(<span style="color: #0000ff;">false</span>);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum7" style="color: #606060;">   7:</span>       }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum8" style="color: #606060;">   8:</span> &nbsp;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum9" style="color: #606060;">   9:</span>       <span style="color: #0000ff;">function</span> Async_deleteObjectStores(txnCommit) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum10" style="color: #606060;">  10:</span>           <span style="color: #0000ff;">try</span> {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum11" style="color: #606060;">  11:</span>               <span style="color: #0000ff;">var</span> dbreq = window.indexedDB.open(indexedDBName);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum12" style="color: #606060;">  12:</span>               dbreq.onsuccess = <span style="color: #0000ff;">function</span> (<span style="color: #0000ff;">event</span>) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum13" style="color: #606060;">  13:</span>                   <span style="color: #0000ff;">var</span> db = <span style="color: #0000ff;">event</span>.result;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum14" style="color: #606060;">  14:</span>                   PrintDBInformation(db);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum15" style="color: #606060;">  15:</span>                   <span style="color: #0000ff;">var</span> setVerReq = db.setVersion(version);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum16" style="color: #606060;">  16:</span>                   setVerReq.onsuccess = <span style="color: #0000ff;">function</span> (<span style="color: #0000ff;">event</span>) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum17" style="color: #606060;">  17:</span>                       <span style="color: #0000ff;">var</span> txn = <span style="color: #0000ff;">event</span>.result;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum18" style="color: #606060;">  18:</span>                       <span style="color: #0000ff;">if</span> (txn) {</pre>
	<pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum28" style="color: #606060;">  28:</span>                           txn.oncomplete = <span style="color: #0000ff;">function</span> () {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum29" style="color: #606060;">  29:</span>                               output_trace(<span style="color: #006080;">"deleteObjectStore completed."</span>);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum30" style="color: #606060;">  30:</span>                               PrintDBInformation(db);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum31" style="color: #606060;">  31:</span>                               db.close();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum32" style="color: #606060;">  32:</span>                           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum33" style="color: #606060;">  33:</span>                           txn.onabort = <span style="color: #0000ff;">function</span> () {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum34" style="color: #606060;">  34:</span>                               output_trace(<span style="color: #006080;">"deleteObjectStore aborted."</span> + ev.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum35" style="color: #606060;">  35:</span>                               PrintDBInformation(db);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum36" style="color: #606060;">  36:</span>                               db.close();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum37" style="color: #606060;">  37:</span>                           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum38" style="color: #606060;">  38:</span>                           txn.ontimeout = <span style="color: #0000ff;">function</span> () {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum39" style="color: #606060;">  39:</span>                               output_trace(<span style="color: #006080;">"deleteObjectStore."</span> + ev.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum40" style="color: #606060;">  40:</span>                               PrintDBInformation(db);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum41" style="color: #606060;">  41:</span>                               db.close();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum42" style="color: #606060;">  42:</span>                           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;">&nbsp;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum19" style="color: #606060;">  19:</span>                           <span style="color: #0000ff;">try</span> {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum20" style="color: #606060;">  20:</span>                               deleteObjectStore(db, txn, OBJECTSTORES,</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum21" style="color: #606060;">  21:</span>                               0, txnCommit);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum22" style="color: #606060;">  22:</span>                           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum23" style="color: #606060;">  23:</span>                           <span style="color: #0000ff;">catch</span> (e) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum24" style="color: #606060;">  24:</span>                               output_trace(<span style="color: #006080;">"deleteObjectStore exception: "</span></pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum25" style="color: #606060;">  25:</span>                               + e.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum26" style="color: #606060;">  26:</span>                               txn.abort();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum27" style="color: #606060;">  27:</span>                           }</pre><!--CRLF-->
	<pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum43" style="color: #606060;">  43:</span>                       }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum44" style="color: #606060;">  44:</span>                   }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum45" style="color: #606060;">  45:</span>                   setVerReq.onerror = <span style="color: #0000ff;">function</span> (<span style="color: #0000ff;">event</span>) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum46" style="color: #606060;">  46:</span>                       output_trace(<span style="color: #006080;">"db.setVersion error. "</span> + <span style="color: #0000ff;">event</span>.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum47" style="color: #606060;">  47:</span>                       db.close();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum48" style="color: #606060;">  48:</span>                   }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum49" style="color: #606060;">  49:</span>                   setVerReq.onblocked = <span style="color: #0000ff;">function</span> (<span style="color: #0000ff;">event</span>) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum50" style="color: #606060;">  50:</span>                       output_trace(<span style="color: #006080;">"db.setVersion blocked. "</span> + <span style="color: #0000ff;">event</span>.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum51" style="color: #606060;">  51:</span>                       db.close();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum52" style="color: #606060;">  52:</span>                   }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum53" style="color: #606060;">  53:</span>               }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum54" style="color: #606060;">  54:</span>               dbreq.onerror = <span style="color: #0000ff;">function</span> (<span style="color: #0000ff;">event</span>) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum55" style="color: #606060;">  55:</span>                   output_trace(<span style="color: #006080;">"indexedDB.open Error: "</span> + <span style="color: #0000ff;">event</span>.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum56" style="color: #606060;">  56:</span>               }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum57" style="color: #606060;">  57:</span>           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum58" style="color: #606060;">  58:</span>           <span style="color: #0000ff;">catch</span> (e) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum59" style="color: #606060;">  59:</span>               output_trace(<span style="color: #006080;">"Error: "</span> + e.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum60" style="color: #606060;">  60:</span>           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum61" style="color: #606060;">  61:</span>       }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum62" style="color: #606060;">  62:</span>            </pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum63" style="color: #606060;">  63:</span>        <span style="color: #0000ff;">function</span> deleteObjectStore(tDb, txn, objs, i, commitT) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum64" style="color: #606060;">  64:</span>           <span style="color: #0000ff;">var</span> <span style="color: #0000ff;">params</span> = objs[i];</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum65" style="color: #606060;">  65:</span>           <span style="color: #0000ff;">var</span> storeReq = tDb.deleteObjectStore(<span style="color: #0000ff;">params</span>.name);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum66" style="color: #606060;">  66:</span>           storeReq.onsuccess = <span style="color: #0000ff;">function</span> (ev) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum67" style="color: #606060;">  67:</span>               output_trace(<span style="color: #006080;">"ObjectStore "</span> + <span style="color: #0000ff;">params</span>.name + <span style="color: #006080;">" deleted."</span>);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum68" style="color: #606060;">  68:</span>               i++;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum69" style="color: #606060;">  69:</span>               <span style="color: #0000ff;">if</span> (i &lt; objs.length)</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum70" style="color: #606060;">  70:</span>                   deleteObjectStore(tDb, txn, objs, i, commitT);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum71" style="color: #606060;">  71:</span>               <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (i == objs.length) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum72" style="color: #606060;">  72:</span>                   <span style="color: #0000ff;">if</span> (commitT == <span style="color: #0000ff;">true</span>)</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum73" style="color: #606060;">  73:</span>                       txn.commit();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum74" style="color: #606060;">  74:</span>                   <span style="color: #0000ff;">else</span></pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum75" style="color: #606060;">  75:</span>                       txn.abort();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum76" style="color: #606060;">  76:</span>               }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum77" style="color: #606060;">  77:</span>           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum78" style="color: #606060;">  78:</span>           storeReq.onerror = <span style="color: #0000ff;">function</span> (ev) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum79" style="color: #606060;">  79:</span>               output_trace(<span style="color: #006080;">"deleteObjectStore "</span> + <span style="color: #0000ff;">params</span>.name + <span style="color: #006080;">" Error: "</span> + ev.message);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum80" style="color: #606060;">  80:</span>               i++;</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum81" style="color: #606060;">  81:</span>               <span style="color: #0000ff;">if</span> (i &lt; objs.length)</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum82" style="color: #606060;">  82:</span>                   deleteObjectStore(tDb, txn, objs, i, commitT);</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum83" style="color: #606060;">  83:</span>               <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (i == objs.length) {</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum84" style="color: #606060;">  84:</span>                   <span style="color: #0000ff;">if</span> (commitT == <span style="color: #0000ff;">true</span>)</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum85" style="color: #606060;">  85:</span>                       txn.commit();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum86" style="color: #606060;">  86:</span>                   <span style="color: #0000ff;">else</span></pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum87" style="color: #606060;">  87:</span>                       txn.abort();</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum88" style="color: #606060;">  88:</span>               }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; background-color: white; direction: ltr; text-align: left;"><span id="lnum89" style="color: #606060;">  89:</span>           }</pre><!--CRLF--><pre style="background-color: #f4f4f4; font-family: 'Courier New', Courier, Monospace; font-size: 8pt; line-height: 12pt; border-style: none; color: black; overflow: visible; padding: 0px; width: 100%; margin: 0em; direction: ltr; text-align: left;"><span id="lnum90" style="color: #606060;">  90:</span>       }</pre><!--CRLF--></div></div>
</body>
</html>